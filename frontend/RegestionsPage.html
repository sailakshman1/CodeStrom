<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Registration Form</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
        }

        .member-card {
            background: linear-gradient(145deg, #f8f9ff, #e8ecff);
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .member-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-outline-danger {
            border-radius: 20px;
            border-width: 2px;
        }

        .form-control,
        .form-select {
            border-radius: 10px;
            border: 2px solid #e1e5e9;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        h2 {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .member-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 15px 20px;
            margin: -15px -15px 20px -15px;
        }

        .add-member-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-member-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
            color: white;
        }
    </style>
</head>

<body>
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="form-container p-4">
                    <div class="text-center mb-4">
                        <h2><i class="fas fa-users me-2"></i>Team Registration Form</h2>
                        <p class="text-muted">Register your team for the competition</p>
                    </div>

                    <form id="teamRegistrationForm">
                        <!-- Team Information -->
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <label for="teamName" class="form-label">
                                    <i class="fas fa-flag me-2"></i>Team Name
                                </label>
                                <input type="text" class="form-control" id="teamName" name="teamName" required>
                            </div>
                            <div class="col-md-4">
                                <label for="teamCount" class="form-label">
                                    <i class="fas fa-hashtag me-2"></i>Team Size
                                </label>
                                <select class="form-select" id="teamCount" name="teamCount" required>
                                    <option value="">Select size</option>
                                    <option value="3">3 Members</option>
                                    <option value="4">4 Members</option>
                                    <option value="5">5 Members</option>
                                </select>
                            </div>
                        </div>

                        <!-- Team Members Section -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="mb-0"><i class="fas fa-user-friends me-2"></i>Team Members</h4>
                            <button type="button" class="btn add-member-btn" id="addMemberBtn">
                                <i class="fas fa-plus me-2"></i>Add Member
                            </button>
                        </div>

                        <div id="membersContainer">
                            <!-- Member forms will be added here dynamically -->
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-paper-plane me-2"></i>Register Team
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        let memberCount = 0;

        const branches = ['CSE', 'IT', 'ECE', 'EEE', 'MECH', 'CIVIL', 'CHEM', 'OTHER'];
        const years = [1, 2, 3, 4];

        function createMemberForm(index) {
            return `
                <div class="member-card p-3" data-member="${index}">
                    <div class="member-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-user me-2"></i>Member ${index + 1}
                            </h5>
                            ${index > 0 ? `
                            <button type="button" class="btn btn-outline-light btn-sm" onclick="removeMember(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                <i class="fas fa-user-tag me-2"></i>Username
                            </label>
                            <input type="text" class="form-control" name="members[${index}][username]" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                <i class="fas fa-envelope me-2"></i>Email
                            </label>
                            <input type="email" class="form-control" name="members[${index}][email]" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                <i class="fas fa-phone me-2"></i>Mobile
                            </label>
                            <input type="tel" class="form-control" name="members[${index}][mobile]" required pattern="[0-9]{10}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">
                                <i class="fas fa-university me-2"></i>College
                            </label>
                            <input type="text" class="form-control" name="members[${index}][college]" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">
                                <i class="fas fa-calendar me-2"></i>Year
                            </label>
                            <select class="form-select" name="members[${index}][year]" required>
                                <option value="">Select year</option>
                                ${years.map(year => `<option value="${year}">${year}</option>`).join('')}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">
                                <i class="fas fa-code-branch me-2"></i>Branch
                            </label>
                            <select class="form-select" name="members[${index}][Branch]" required>
                                <option value="">Select branch</option>
                                ${branches.map(branch => `<option value="${branch}">${branch}</option>`).join('')}
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">
                                <i class="fas fa-map-marker-alt me-2"></i>City
                            </label>
                            <input type="text" class="form-control" name="members[${index}][city]" required>
                        </div>
                    </div>
                </div>
            `;
        }

        function addMember() {
            const container = document.getElementById('membersContainer');
            container.insertAdjacentHTML('beforeend', createMemberForm(memberCount));
            memberCount++;
            updateTeamCount();
        }

        function removeMember(index) {
            const memberCard = document.querySelector(`[data-member="${index}"]`);
            memberCard.remove();
            updateTeamCount();
            reindexMembers();
        }

        function updateTeamCount() {
            const visibleMembers = document.querySelectorAll('.member-card').length;
            document.getElementById('teamCount').value = visibleMembers;
        }

        function reindexMembers() {
            const memberCards = document.querySelectorAll('.member-card');
            memberCards.forEach((card, index) => {
                card.setAttribute('data-member', index);
                card.querySelector('.member-header h5').innerHTML = `<i class="fas fa-user me-2"></i>Member ${index + 1}`;


                const inputs = card.querySelectorAll('input, select');
                inputs.forEach(input => {
                    const name = input.getAttribute('name');
                    if (name) {
                        const newName = name.replace(/\[\d+\]/, `[${index}]`);
                        input.setAttribute('name', newName);
                    }
                });


                const removeBtn = card.querySelector('.btn-outline-light');
                if (removeBtn && index > 0) {
                    removeBtn.setAttribute('onclick', `removeMember(${index})`);
                }
            });
        }

        document.getElementById('addMemberBtn').addEventListener('click', addMember);

        document.getElementById('teamCount').addEventListener('change', function () {
            const targetCount = parseInt(this.value);
            const currentCount = document.querySelectorAll('.member-card').length;

            if (targetCount > currentCount) {
                for (let i = currentCount; i < targetCount; i++) {
                    addMember();
                }
            } else if (targetCount < currentCount) {
                const memberCards = document.querySelectorAll('.member-card');
                for (let i = currentCount - 1; i >= targetCount; i--) {
                    memberCards[i].remove();
                }
                reindexMembers();
            }
        });

        document.getElementById('teamRegistrationForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const teamData = {
                teamName: formData.get('teamName'),
                teamCount: parseInt(formData.get('teamCount')),
                members: []
            };


            const memberCards = document.querySelectorAll('.member-card');
            memberCards.forEach((card, index) => {
                const member = {
                    username: formData.get(`members[${index}][username]`),
                    email: formData.get(`members[${index}][email]`),
                    mobile: formData.get(`members[${index}][mobile]`),
                    college: formData.get(`members[${index}][college]`),
                    year: parseInt(formData.get(`members[${index}][year]`)),
                    Branch: formData.get(`members[${index}][Branch]`),
                    city: formData.get(`members[${index}][city]`)
                };
                teamData.members.push(member);
            });

            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Registering...';
            submitBtn.disabled = true;

            try {
                const response = await fetch('http://localhost:8080/registertion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(teamData)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert('Team registered successfully! ðŸŽ‰');
                    console.log('Registration successful:', result);

                    this.reset();
                    document.getElementById('membersContainer').innerHTML = '';
                    memberCount = 0;
                    for (let i = 0; i < 3; i++) {
                        addMember();
                    }

                    window.location.href = '/index.html';
                }
                else {
                    const error = await response.text();
                    alert('Registration failed: ' + error);
                    window.location.href = '/index.html';
                    console.error('Registration error:', error);
                }
            } catch (error) {
                alert('Network error: Please check if the server is running.');
                console.error('Network error:', error);
            } finally {

                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });


        for (let i = 0; i < 3; i++) {
            addMember();
        }
    </script>
</body>

</html>